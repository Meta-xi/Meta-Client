import{a as $,b as h,c as j,d as U,h as B,j as G,k as Z,l as H,n as K}from"./chunk-A3R2OZES.js";import{a as Y}from"./chunk-HTONRPL5.js";import"./chunk-I6QIW7BD.js";import"./chunk-WXI33M2S.js";import{a as D,e as q,j as O,l as z}from"./chunk-GP7BZZWX.js";import{$a as T,Fb as C,Ga as R,Hb as v,Ka as n,La as L,W as w,Z as F,_a as y,ab as m,ac as x,cc as P,d as _,ea as N,fa as S,ga as k,gc as M,jb as s,kb as l,lb as g,ob as V,qb as c,r as E,rb as b,sb as A,xb as p,yb as I,zb as f}from"./chunk-HLI2SXL3.js";var X=i=>({"rounded-md":i});function ee(i,a){i&1&&(s(0,"span",14),p(1,"+57"),l())}function te(i,a){if(i&1&&(s(0,"small",15),p(1),l()),i&2){let d,r=b();n(),I((d=r.loginForm.get("username"))==null||d.errors==null?null:d.errors.usernameInvalid)}}function re(i,a){if(i&1&&(s(0,"small",15),p(1),l()),i&2){let d,r=b();n(),I((d=r.loginForm.get("password"))==null||d.errors==null?null:d.errors.passwordInvalid)}}function oe(i,a){i&1&&(s(0,"small",15),p(1,"Repetir contrase\xF1a es requerido."),l())}function ie(i,a){i&1&&(s(0,"small",15),p(1,"Las contrase\xF1as no coinciden."),l())}function ne(i,a){if(i&1){let d=V();s(0,"div",1)(1,"label",16),p(2,"Repetir contrase\xF1a:"),l(),s(3,"div",8),g(4,"input",17),s(5,"span",10),c("click",function(){S(d);let t=b();return k(t.togglePasswordVisibility())}),g(6,"img",11),l()(),y(7,oe,2,0,"small",6)(8,ie,2,0,"small",6),l()}if(i&2){let d,r,t=b();n(4),m("type",t.passwordFieldType),n(2),m("src",t.passwordFieldType==="password"?"assets/icons/eye.svg":"assets/icons/eyeblock.svg",R),n(),m("ngIf",((d=t.loginForm.get("newPassword"))==null||d.errors==null?null:d.errors.required)&&((d=t.loginForm.get("newPassword"))==null?null:d.touched)),n(),m("ngIf",(t.loginForm.errors==null?null:t.loginForm.errors.mismatch)&&((r=t.loginForm.get("newPassword"))==null?null:r.touched))}}var J=(()=>{let a=class a{constructor(r){this.notification=r,this.fb=w(H),this.http=w(D),this.route=w(O),this.typeLogin="",this.isRegistered=!1,this.passwordFieldType="password",this.message="",this.messageType="success",this.router=w(z),this.codeReferrer=null}ngOnInit(){this.route.queryParamMap.subscribe(t=>{this.codeReferrer=t.get("code")});let r={username:["",[h.required,this.userNameValidator(this.typeLogin),...this.typeLogin==="N\xFAmero de tel\xE9fono"?[h.pattern(/^\d+$/)]:[]]],password:["",[h.required,this.passwordValidator]],newPassword:this.isRegistered?null:["",h.required]};this.loginForm=this.fb.group(r,{validators:this.passwordMatchValidator(this.isRegistered)})}ngOnChanges(r){if(r.isRegistered&&this.loginForm&&(this.isRegistered?this.loginForm.get("newPassword")&&this.loginForm.removeControl("newPassword"):this.loginForm.get("newPassword")||this.loginForm.addControl("newPassword",this.fb.control("",h.required))),r.typeLogin&&this.loginForm){let t=this.loginForm.get("username");t&&(t.clearValidators(),t.setValidators([h.required,this.userNameValidator(this.typeLogin)]),t.updateValueAndValidity())}}userNameValidator(r){return t=>{let e=t.value,o=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e),u=/^\d+$/.test(e);return console.log(r),r==="N\xFAmero de tel\xE9fono"&&!u?{usernameInvalid:"Debe ingresar un n\xFAmero de tel\xE9fono v\xE1lido"}:r==="Correo electr\xF3nico"&&!o?{usernameInvalid:"Correo inv\xE1lido"}:null}}passwordValidator(r){let t=r.value;return t&&t.length>=6?null:{passwordInvalid:"La contrase\xF1a debe tener al menos 6 caracteres."}}passwordMatchValidator(r){return t=>{let e=t.get("password"),o=t.get("newPassword");return!r&&e&&o?e.value===o.value?null:{mismatch:!0}:null}}onSubmit(){return _(this,null,function*(){if(console.log("Formulario valido: ",this.loginForm.valid),console.log("Errores en el formulario: ",this.loginForm.errors),console.log(this.isRegistered),console.log(this.loginForm.value),this.loginForm.valid){let{username:r,password:t}=this.loginForm.value,e;if(this.isRegistered){e=this.typeLogin==="N\xFAmero de tel\xE9fono"?{email:null,phoneNumber:r,password:t}:{email:r,phoneNumber:null,password:t};try{console.log(e);let o=yield this.login(e);this.message="Login exitoso",localStorage.setItem("token",o),localStorage.setItem("username",r),console.log(o),this.notification.correct("Login exitoso"),setTimeout(()=>{this.router.navigate(["/home"])},6e3)}catch(o){this.notification.errorMessage(`${o}`)}}else{let o=this.typeLogin==="N\xFAmero de tel\xE9fono"?{email:null,phoneNumber:r,password:t,codeReferrer:this.codeReferrer||null}:{email:r,phoneNumber:null,password:t,codeReferrer:this.codeReferrer||null};try{console.log(o);let u=yield this.register(o);console.log(u.status),localStorage.setItem("username",r),this.notification.correct(u.message),setTimeout(()=>{this.router.navigate(["/home"])},6e3)}catch(u){console.error(u),this.notification.errorMessage(`${u}`)}}}})}togglePasswordVisibility(){this.passwordFieldType=this.passwordFieldType==="password"?"text":"password"}login(r){return _(this,null,function*(){let t="https://meta-api-production-3abd.up.railway.app/api/User/Login";try{return yield E(this.http.post(t,r,{responseType:"text"}))}catch(e){let o="Error desconocido";throw e.error&&(typeof e.error=="string"?o=e.error:e.error.message&&(o=e.error.message)),o}})}register(r){return _(this,null,function*(){let t="https://meta-api-production-3abd.up.railway.app/api/User/UserRegister";try{let e=yield E(this.http.post(t,r,{observe:"response"}));return e.status===200?e.body:e.status===400?(console.log(e.body),"Error: "+e.body):e.status===404?"Error: "+e.body:"Error desconocido"}catch(e){let o="Error desconocido";throw typeof e.error=="string"?o=e.error:e.error&&e.error.message&&(o=e.error.message),o}})}allowOnlyNumbers(r){let t=r.key;!/^[0-9]$/.test(t)&&t!=="Backspace"&&t!=="Delete"&&r.preventDefault()}};a.\u0275fac=function(t){return new(t||a)(L(Y))},a.\u0275cmp=F({type:a,selectors:[["app-form"]],inputs:{typeLogin:"typeLogin",isRegistered:"isRegistered"},standalone:!0,features:[N,C],decls:19,vars:15,consts:[[1,"px-4","flex","flex-col","sm:gap-5","gap-2",3,"ngSubmit","formGroup"],[1,"mb-2"],["for","username",1,"block","sm:py-4","pb-2"],[1,"flex"],["class","inline-flex items-center px-3 bg-gray-200 border border-r-0 border-gray-300 text-gray-900 rounded-l-md",4,"ngIf"],["id","username","formControlName","username",1,"w-full","px-3","py-2","border","text-gray-900","border-gray-300","rounded-r-md","focus:outline-none","focus:ring","focus:ring-blue-500",3,"keypress","ngClass","placeholder"],["class","text-red-500",4,"ngIf"],["for","password",1,"block","sm:py-4","pb-2"],[1,"relative"],["id","password","formControlName","password","placeholder","Contrase\xF1a",1,"w-full","px-3","py-2","border","border-gray-300","text-gray-900","rounded-md","focus:outline-none","focus:ring","focus:ring-blue-500",3,"type"],[1,"absolute","inset-y-0","right-0","pr-3","flex","items-center","cursor-pointer",3,"click"],["alt","Toggle password visibility",1,"w-6",3,"src"],["class","mb-2",4,"ngIf"],["type","submit",1,"w-full","px-4","py-4","cursor-pointer","bg-[#301E67]","font-semibold","rounded-md"],[1,"inline-flex","items-center","px-3","bg-gray-200","border","border-r-0","border-gray-300","text-gray-900","rounded-l-md"],[1,"text-red-500"],["for","newPassword",1,"block","sm:py-4","pb-2","mt-3"],["id","newPassword","formControlName","newPassword","placeholder","Repita su contrase\xF1a",1,"w-full","px-3","py-2","border","border-gray-300","text-gray-900","rounded-md","focus:outline-none","focus:ring","focus:ring-blue-500",3,"type"]],template:function(t,e){if(t&1&&(s(0,"form",0),c("ngSubmit",function(){return e.onSubmit()}),s(1,"div",1)(2,"label",2),p(3),l(),s(4,"div",3),y(5,ee,2,0,"span",4),s(6,"input",5),c("keypress",function(u){return e.typeLogin==="N\xFAmero de tel\xE9fono"?e.allowOnlyNumbers(u):null}),l()(),y(7,te,2,1,"small",6),l(),s(8,"div",1)(9,"label",7),p(10,"Contrase\xF1a:"),l(),s(11,"div",8),g(12,"input",9),s(13,"span",10),c("click",function(){return e.togglePasswordVisibility()}),g(14,"img",11),l()(),y(15,re,2,1,"small",6),l(),y(16,ne,9,4,"div",12),s(17,"button",13),p(18),l()()),t&2){let o,u;m("formGroup",e.loginForm),n(3),f("",e.typeLogin,":"),n(2),m("ngIf",e.typeLogin==="N\xFAmero de tel\xE9fono"),n(),A("placeholder",e.typeLogin),m("ngClass",v(13,X,e.typeLogin!=="N\xFAmero de tel\xE9fono")),T("type",e.typeLogin==="N\xFAmero de tel\xE9fono"?"tel":"text")("inputmode",e.typeLogin==="N\xFAmero de tel\xE9fono"?"numeric":"text"),n(),m("ngIf",((o=e.loginForm.get("username"))==null||o.errors==null?null:o.errors.usernameInvalid)&&((o=e.loginForm.get("username"))==null?null:o.touched)),n(5),m("type",e.passwordFieldType),n(2),m("src",e.passwordFieldType==="password"?"assets/icons/eye.svg":"assets/icons/eyeblock.svg",R),n(),m("ngIf",((u=e.loginForm.get("password"))==null||u.errors==null?null:u.errors.passwordInvalid)&&((u=e.loginForm.get("password"))==null?null:u.touched)),n(),m("ngIf",!e.isRegistered),n(2),f(" ",e.isRegistered?"Iniciar Sesi\xF3n":"Registrarse"," ")}},dependencies:[K,B,$,j,U,G,Z,x,q,M,P]});let i=a;return i})();var Q=i=>({"bg-[#301E67] shadow-xl font-semibold":i}),Fe=(()=>{let a=class a{constructor(){this.btnC=!0,this.typeAuth="Correo electr\xF3nico",this.isRegistered=!1}ngOnInit(){this.email()}email(){this.btnC=!0,this.typeAuth="Correo electr\xF3nico",console.log("typeAuth cambiado a :",this.typeAuth)}telf(){this.btnC=!1,this.typeAuth="N\xFAmero de tel\xE9fono",console.log("typeAuth cambiado a :",this.typeAuth)}goLogin(){this.isRegistered=!this.isRegistered}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=F({type:a,selectors:[["app-login"]],standalone:!0,features:[C],decls:13,vars:11,consts:[[1,"fixed","top-0","left-0","w-screen","h-screen","flex","flex-col","sm:flex-row"],[1,"flex","w-screen","md:w-1/2","h-1/3","sm:h-auto","login_img_section"],["src","assets/others/login.jpg","alt","avatar",1,"sm:hidden","w-full"],[1,"flex","w-full","sm:w-1/2","h-2/3","sm:h-auto","justify-center","items-center","relative","bg-[#3E183D]"],[1,"w-full","h-full","px-3","sm:p-5","flex","flex-col","absolute","-top-9","gap-5"],[1,"flex","items-center","bg-blue-950","mt-7","rounded-xl","shadow-xl"],[1,"w-1/2","sm:p-4","p-2","rounded-xl","text-center",3,"click","ngClass"],[1,"w-1/2","h-full","sm:p-4","p-2","rounded-xl","text-center",3,"click","ngClass"],[3,"typeLogin","isRegistered"],[1,"text-center","underline",3,"click"]],template:function(t,e){t&1&&(s(0,"div",0)(1,"div",1),g(2,"img",2),l(),s(3,"div",3)(4,"div",4)(5,"div",5)(6,"button",6),c("click",function(){return e.email()}),p(7),l(),s(8,"button",7),c("click",function(){return e.telf()}),p(9),l()(),g(10,"app-form",8),s(11,"a",9),c("click",function(){return e.goLogin()}),p(12),l()()()()),t&2&&(n(6),m("ngClass",v(7,Q,e.btnC)),n(),f(" ",e.isRegistered?"Iniciar sesi\xF3n por correo electr\xF3nico":"Registarse por correo electr\xF3nico"," "),n(),m("ngClass",v(9,Q,!e.btnC)),n(),f(" ",e.isRegistered?"Iniciar sesi\xF3n por tel\xE9fono":"Registarse por tel\xE9fono"," "),n(),m("typeLogin",e.typeAuth)("isRegistered",e.isRegistered),n(2),f(" ",e.isRegistered?"\xBFNo tienes una cuenta? Reg\xEDstrate":"\xBFYa tienes una cuenta? Inicia sesi\xF3n"," "))},dependencies:[x,J],styles:[".login_img_section[_ngcontent-%COMP%]{background:linear-gradient(#02020291,#0000006b),url(/assets/others/login.jpg) center center;background-size:cover;background-repeat:no-repeat}"]});let i=a;return i})();export{Fe as LoginComponent};
