import{a as M,b as y,c as O,d as L,e as U,f as v,h as G,j as D,k as q,m as z,n as H}from"./chunk-A3R2OZES.js";import{a as j}from"./chunk-VBQHL3HI.js";import{a as R}from"./chunk-HTONRPL5.js";import"./chunk-I6QIW7BD.js";import"./chunk-WXI33M2S.js";import{a as x,e as V,l as k}from"./chunk-GP7BZZWX.js";import{Fb as E,Ga as h,Ka as i,La as T,W as _,Z as b,_a as g,ab as n,cc as N,d as F,gc as I,jb as a,kb as d,lb as p,qb as f,r as P,rb as C,xb as w,zb as S}from"./chunk-HLI2SXL3.js";function A(r,l){r&1&&(a(0,"div",10),w(1," La contrase\xF1a anterior es obligatoria "),d())}function B(r,l){if(r&1&&(a(0,"div"),w(1),d()),r&2){let u,s=C(2);i(),S(" ",(u=s.passwordForm.get("newPassword"))==null?null:u.getError("passwordInvalid")," ")}}function $(r,l){if(r&1&&(a(0,"div",10),g(1,B,2,1,"div",11),d()),r&2){let u,s=C();i(),n("ngIf",(u=s.passwordForm.get("newPassword"))==null?null:u.hasError("passwordInvalid"))}}function J(r,l){r&1&&(a(0,"div",10),w(1," Confirmar contrase\xF1a es obligatoria "),d())}function K(r,l){r&1&&(a(0,"div",12),w(1," Las contrase\xF1as no coinciden "),d())}var ne=(()=>{let l=class l{constructor(s){this.notification=s,this.passwordFieldTypeOld="password",this.passwordFieldTypeNew="password",this.passwordFieldTypeConfirm="password",this.message="",this.messageType="success",this.http=_(x),this.router=_(k)}ngOnInit(){this.passwordForm=new U({oldPassword:new v("",[y.required]),newPassword:new v("",[y.required,this.PasswordValidator]),confirmPassword:new v("",[y.required])},{validators:this.passwordMatchValidator})}OnSubmit(){return F(this,null,function*(){if(console.log(this.passwordForm.valid),this.passwordForm.valid){let s=localStorage.getItem("username")||"",o=this.passwordForm.get("oldPassword")?.value,e=this.passwordForm.get("newPassword")?.value;if(console.log(s),!s){this.message="El nombre de usuario no est\xE1 disponible",this.messageType="error";return}try{let t=yield this.ChangePassword({Username:s,OldPassword:o,NewPassword:e});console.log(t.message),this.notification.correct(t.message),setTimeout(()=>{this.router.navigate(["../me"])},6e3)}catch(t){this.notification.errorMessage(`${t}`)}}})}PasswordValidator(s){let o=s.value;return o&&o.length>=6?null:{passwordInvalid:"La contrase\xF1a debe tener al menos 6 caracteres."}}passwordMatchValidator(s){let o=s.get("newPassword")?.value,e=s.get("confirmPassword")?.value;return o&&e?o===e?null:{passwordMismatch:"Las contrase\xF1as no coinciden"}:null}togglePasswordVisibility(s){s==="old"?this.passwordFieldTypeOld=this.passwordFieldTypeOld==="password"?"text":"password":s==="new"?this.passwordFieldTypeNew=this.passwordFieldTypeNew==="password"?"text":"password":s==="confirm"&&(this.passwordFieldTypeConfirm=this.passwordFieldTypeConfirm==="password"?"text":"password")}ChangePassword(s){return F(this,null,function*(){let o="https://meta-api-production-3abd.up.railway.app/api/User/UpdatePassword";try{let e=yield P(this.http.patch(o,s,{observe:"response"}));return e.status===200?e.body:e.status===400||e.status===404?"Error: "+e.body:"Error desconocido"}catch(e){let t="Error desconocido";throw typeof e.error=="string"?t=e.error:e.error&&e.error.message&&(t=e.error.message),t}})}};l.\u0275fac=function(o){return new(o||l)(T(R))},l.\u0275cmp=b({type:l,selectors:[["app-changepass"]],standalone:!0,features:[E],decls:20,vars:11,consts:[[1,"w-full","flex","flex-col","gap-3","bg-blue-950","p-5","rounded-xl","text-gray-800",3,"ngSubmit","formGroup"],[1,"relative","w-full"],["formControlName","oldPassword","placeholder","Contrase\xF1a anterior","type","password",1,"w-full","p-3","rounded-lg",3,"type"],[1,"absolute","inset-y-0","right-0","pr-3","flex","items-center","cursor-pointer",3,"click"],["alt","Toggle password visibility",1,"w-6",3,"src"],["class","text-red-500 text-sm",4,"ngIf"],["formControlName","newPassword","placeholder","Nueva contrase\xF1a","type","password",1,"w-full","p-3","rounded-lg",3,"type"],["formControlName","confirmPassword","placeholder","Re-ingrese nueva contrase\xF1a","type","password",1,"w-full","p-3","rounded-lg",3,"type"],["class","text-red-500",4,"ngIf"],[1,"bg-[#301E67]","text-white","p-3","rounded-lg","shadow-xl"],[1,"text-red-500","text-sm"],[4,"ngIf"],[1,"text-red-500"]],template:function(o,e){if(o&1&&(p(0,"app-back-home"),a(1,"form",0),f("ngSubmit",function(){return e.OnSubmit()}),a(2,"div",1),p(3,"input",2),a(4,"span",3),f("click",function(){return e.togglePasswordVisibility("old")}),p(5,"img",4),d()(),g(6,A,2,0,"div",5),a(7,"div",1),p(8,"input",6),a(9,"span",3),f("click",function(){return e.togglePasswordVisibility("new")}),p(10,"img",4),d()(),g(11,$,2,1,"div",5),a(12,"div",1),p(13,"input",7),a(14,"span",3),f("click",function(){return e.togglePasswordVisibility("confirm")}),p(15,"img",4),d()(),g(16,J,2,0,"div",5)(17,K,2,0,"div",8),a(18,"button",9),w(19,"Confirmar"),d()()),o&2){let t,m,c;i(),n("formGroup",e.passwordForm),i(2),n("type",e.passwordFieldTypeOld),i(2),n("src",e.passwordFieldTypeOld==="password"?"assets/icons/eye.svg":"assets/icons/eyeblock.svg",h),i(),n("ngIf",((t=e.passwordForm.get("oldPassword"))==null?null:t.invalid)&&(((t=e.passwordForm.get("oldPassword"))==null?null:t.dirty)||((t=e.passwordForm.get("oldPassword"))==null?null:t.touched))),i(2),n("type",e.passwordFieldTypeNew),i(2),n("src",e.passwordFieldTypeNew==="password"?"assets/icons/eye.svg":"assets/icons/eyeblock.svg",h),i(),n("ngIf",((m=e.passwordForm.get("newPassword"))==null?null:m.errors)&&(((m=e.passwordForm.get("newPassword"))==null?null:m.dirty)||((m=e.passwordForm.get("newPassword"))==null?null:m.touched))),i(2),n("type",e.passwordFieldTypeConfirm),i(2),n("src",e.passwordFieldTypeConfirm==="password"?"assets/icons/eye.svg":"assets/icons/eyeblock.svg",h),i(),n("ngIf",((c=e.passwordForm.get("confirmPassword"))==null?null:c.errors)&&(((c=e.passwordForm.get("confirmPassword"))==null?null:c.dirty)||((c=e.passwordForm.get("confirmPassword"))==null?null:c.touched))),i(),n("ngIf",e.passwordForm.hasError("passwordMismatch"))}},dependencies:[j,z,G,M,O,L,H,D,q,I,N,V]});let r=l;return r})();export{ne as ChangepassComponent};
